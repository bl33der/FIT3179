{
  "$schema": "https://vega.github.io/schema/vega/v6.json",
  "background": "white",
  "padding": 5,
  "width": 800,
  "height": 400,
  "title": {
    "text": "Australian Tobacco user comparison on Global Scale (2025)",
    "frame": "group"
  },
  "style": "view",
  "data": [
    {
      "name": "source_1",
      "url": "https://raw.githubusercontent.com/bl33der/FIT3179/main/JS/smoking-rates-by-country-2025.json",
      "format": {"type": "json"}
    },
    {
      "name": "source_2",
      "values": [
        {
          "flagCode": "AU",
          "country": "Australia",
          "lon": 133.7751,
          "lat": -25.2744,
          "tx_lon": 165,
          "tx_lat": -10
        }
      ]
    },
    {
      "name": "source_0",
      "url": "https://raw.githubusercontent.com/bl33der/FIT3179/main/JS/ne_110m_admin_0_countries.json",
      "format": {
        "type": "topojson",
        "feature": "ne_110m_admin_0_countries",
        "parse": {}
      },
      "transform": [
        {
          "type": "formula",
          "expr": "datum[\"properties\"] && datum[\"properties\"][\"NAME\"]",
          "as": "properties.NAME"
        },
        {
          "type": "formula",
          "expr": "datum.properties.ISO_A2 ? datum.properties.ISO_A2 : datum.properties.ISO_A2_EH",
          "as": "A2"
        },
        {
          "type": "lookup",
          "from": "source_1",
          "key": "flagCode",
          "fields": ["A2"],
          "values": [
            "country",
            "TotalSmokersAsPctOfPop_2025",
            "MaleSmokersAsPctOfPop_2025",
            "FemaleSmokersAsPctOfPop_2025",
            "flagCode"
          ]
        },
        {
          "type": "filter",
          "expr": "datum.flagCode && datum.country && datum.country !== 'Total'"
        },
        {
          "type": "formula",
          "expr": "sex == 'All' ? toNumber(datum.TotalSmokersAsPctOfPop_2025) : (sex == 'Male' ? toNumber(datum.MaleSmokersAsPctOfPop_2025) : toNumber(datum.FemaleSmokersAsPctOfPop_2025))",
          "as": "Rate"
        },
        {
          "type": "filter",
          "expr": "isValid(datum[\"Rate\"]) && isFinite(+datum[\"Rate\"])"
        }
      ]
    },
    {
      "name": "data_0",
      "source": "source_2",
      "transform": [
        {
          "type": "lookup",
          "from": "source_1",
          "key": "flagCode",
          "fields": ["flagCode"],
          "values": [
            "TotalSmokersAsPctOfPop_2025",
            "MaleSmokersAsPctOfPop_2025",
            "FemaleSmokersAsPctOfPop_2025"
          ]
        },
        {
          "type": "formula",
          "expr": "sex == 'All' ? toNumber(datum.TotalSmokersAsPctOfPop_2025) : (sex == 'Male' ? toNumber(datum.MaleSmokersAsPctOfPop_2025) : toNumber(datum.FemaleSmokersAsPctOfPop_2025))",
          "as": "AusRate"
        },
        {
          "type": "formula",
          "expr": "'Australia â€” ' + format(datum.AusRate, '.1f') + '% (' + sex + ')'",
          "as": "Label"
        }
      ]
    },
    {
      "name": "data_1",
      "source": "data_0",
      "transform": [
        {
          "type": "geojson",
          "fields": ["lon", "lat"],
          "signal": "layer_1_layer_0_geojson_0"
        },
        {
          "type": "geojson",
          "fields": ["tx_lon", "tx_lat"],
          "signal": "layer_1_layer_0_geojson_1"
        },
        {
          "type": "geopoint",
          "projection": "projection",
          "fields": ["lon", "lat"],
          "as": ["layer_1_layer_0_x", "layer_1_layer_0_y"]
        },
        {
          "type": "geopoint",
          "projection": "projection",
          "fields": ["tx_lon", "tx_lat"],
          "as": ["layer_1_layer_0_x2", "layer_1_layer_0_y2"]
        }
      ]
    },
    {
      "name": "data_2",
      "source": "data_0",
      "transform": [
        {
          "type": "geojson",
          "fields": ["lon", "lat"],
          "signal": "layer_1_layer_1_geojson_0"
        },
        {
          "type": "geopoint",
          "projection": "projection",
          "fields": ["lon", "lat"],
          "as": ["layer_1_layer_1_x", "layer_1_layer_1_y"]
        }
      ]
    },
    {
      "name": "data_3",
      "source": "data_0",
      "transform": [
        {
          "type": "geojson",
          "fields": ["tx_lon", "tx_lat"],
          "signal": "layer_1_layer_2_geojson_0"
        },
        {
          "type": "geopoint",
          "projection": "projection",
          "fields": ["tx_lon", "tx_lat"],
          "as": ["layer_1_layer_2_x", "layer_1_layer_2_y"]
        }
      ]
    }
  ],
  "projections": [
    {
      "name": "projection",
      "size": {"signal": "[width, height]"},
      "fit": {
        "signal": "[data('source_0'), layer_1_layer_0_geojson_0, layer_1_layer_0_geojson_1, layer_1_layer_1_geojson_0, layer_1_layer_2_geojson_0]"
      },
      "type": "equalEarth"
    }
  ],
  "signals": [
    {
      "name": "sex",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "Male", "Female"],
        "name": "Show: "
      }
    }
  ],
  "marks": [
    {
      "name": "layer_0_marks",
      "type": "shape",
      "style": ["geoshape"],
      "from": {"data": "source_0"},
      "encode": {
        "update": {
          "stroke": {"value": "#ffffff"},
          "strokeWidth": {"value": 0.6},
          "fill": [
            {"test": "isValid(datum.Rate)", "scale": "color", "field": "Rate"},
            {"value": "#e5e7eb"}
          ],
          "tooltip": {
            "signal": "{\"Country\": isValid(datum[\"properties.NAME\"]) ? datum[\"properties.NAME\"] : \"\"+datum[\"properties.NAME\"], \"Smokers (%)\": format(datum[\"Rate\"], \".1f\"), \"Total (%)\": format(datum[\"TotalSmokersAsPctOfPop_2025\"], \".1f\"), \"Male (%)\": format(datum[\"MaleSmokersAsPctOfPop_2025\"], \".1f\"), \"Female (%)\": format(datum[\"FemaleSmokersAsPctOfPop_2025\"], \".1f\")}"
          },
          "ariaRoleDescription": {"value": "geoshape"},
          "description": {
            "signal": "\"Smokers (%): \" + (format(datum[\"Rate\"], \"\")) + \"; Country: \" + (isValid(datum[\"properties.NAME\"]) ? datum[\"properties.NAME\"] : \"\"+datum[\"properties.NAME\"]) + \"; Total (%): \" + (format(datum[\"TotalSmokersAsPctOfPop_2025\"], \".1f\")) + \"; Male (%): \" + (format(datum[\"MaleSmokersAsPctOfPop_2025\"], \".1f\")) + \"; Female (%): \" + (format(datum[\"FemaleSmokersAsPctOfPop_2025\"], \".1f\"))"
          }
        }
      },
      "transform": [{"type": "geoshape", "projection": "projection"}]
    },
    {
      "name": "layer_1_layer_0_marks",
      "type": "rule",
      "style": ["rule"],
      "from": {"data": "data_1"},
      "encode": {
        "update": {
          "stroke": {"value": "#111827"},
          "strokeWidth": {"value": 1.2},
          "description": {
            "signal": "\"lon: \" + (format(datum[\"lon\"], \"\")) + \"; tx_lon: \" + (format(datum[\"tx_lon\"], \"\")) + \"; lat: \" + (format(datum[\"lat\"], \"\")) + \"; tx_lat: \" + (format(datum[\"tx_lat\"], \"\"))"
          },
          "x": {"field": "layer_1_layer_0_x"},
          "x2": {"field": "layer_1_layer_0_x2"},
          "y": {"field": "layer_1_layer_0_y"},
          "y2": {"field": "layer_1_layer_0_y2"}
        }
      }
    },
    {
      "name": "layer_1_layer_1_marks",
      "type": "symbol",
      "style": ["circle"],
      "from": {"data": "data_2"},
      "encode": {
        "update": {
          "opacity": {"value": 0.7},
          "stroke": {"value": "#111827"},
          "strokeWidth": {"value": 1},
          "size": {"value": 90},
          "fill": {"value": "white"},
          "ariaRoleDescription": {"value": "circle"},
          "description": {
            "signal": "\"lon: \" + (format(datum[\"lon\"], \"\")) + \"; lat: \" + (format(datum[\"lat\"], \"\"))"
          },
          "x": {"field": "layer_1_layer_1_x"},
          "y": {"field": "layer_1_layer_1_y"},
          "shape": {"value": "circle"}
        }
      }
    },
    {
      "name": "layer_1_layer_2_marks",
      "type": "text",
      "style": ["text"],
      "from": {"data": "data_3"},
      "encode": {
        "update": {
          "stroke": {"value": "white"},
          "strokeWidth": {"value": 3},
          "align": {"value": "left"},
          "dx": {"value": 6},
          "dy": {"value": 0},
          "fontSize": {"value": 12},
          "fontWeight": {"value": "bold"},
          "fill": {"value": "#111827"},
          "description": {
            "signal": "\"tx_lon: \" + (format(datum[\"tx_lon\"], \"\")) + \"; tx_lat: \" + (format(datum[\"tx_lat\"], \"\")) + \"; Label: \" + (isValid(datum[\"Label\"]) ? datum[\"Label\"] : \"\"+datum[\"Label\"])"
          },
          "x": {"field": "layer_1_layer_2_x"},
          "y": {"field": "layer_1_layer_2_y"},
          "text": {
            "signal": "isValid(datum[\"Label\"]) ? datum[\"Label\"] : \"\"+datum[\"Label\"]"
          },
          "baseline": {"value": "middle"}
        }
      }
    }
  ],
  "scales": [
    {
      "name": "color",
      "type": "linear",
      "domain": {"data": "source_0", "field": "Rate"},
      "range": {"scheme": "reds"},
      "interpolate": "hcl",
      "zero": false
    }
  ],
  "legends": [
    {
      "gradientLength": 160,
      "orient": "bottom",
      "title": "Smokers (%)",
      "fill": "color",
      "direction": "horizontal"
    }
  ],
  "config": {
    "style": {
      "guide-label": {
        "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial"
      },
      "guide-title": {
        "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial"
      },
      "group-title": {
        "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial",
        "fontSize": 18
      },
      "group-subtitle": {
        "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial"
      },
      "cell": {"stroke": null},
      "text": {
        "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial"
      }
    },
    "title": {"subtitleFontSize": 12}
  }
}